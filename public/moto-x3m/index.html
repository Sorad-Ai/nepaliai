<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="viewport"
      content="initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="assets/css/app.css" type="text/css" />
    <title>MotoX3M</title>
  </head>

  <body>
    <div id="content"></div>
    <div id="orientation"></div>
    <div id="loader">Loading ...</div>
    <script
      type="text/javascript"
      src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"
    ></script>
    <script type="text/javascript" src="assets/box2dweb/nape.min.js">
      var nape = "nape.min.js";
    </script>
    <script
      type="text/javascript"
      src="assets/box2dweb/nape-debug-draw.min.js"
    ></script>
    <script
      type="text/javascript"
      src="assets/box2dweb/jquery-3.1.1.min.js"
    ></script>
    <script
      type="text/javascript"
      src="assets/box2dweb/easeljs-0.8.2.combined.js"
    ></script>
    <script
      type="text/javascript"
      src="assets/box2dweb/bluebird.min.js"
    ></script>

    <script type="text/javascript"></script>

    <script
      type="text/javascript"
      src="motox3m4.min.js?30ce0fae5b364628ca27"
    ></script>

    <script>
      // Function to focus the element by id 't' and trigger a specific key press
      function focusAndPressKey(keyCode, keyValue) {
        const gameElement = document.querySelector("body");
        if (gameElement) {
          gameElement.focus();

          // Simulate keydown event
          const keyPressEvent = new KeyboardEvent("keydown", {
            key: keyValue,
            code: keyValue,
            keyCode: keyCode,
            which: keyCode,
            bubbles: true,
            cancelable: true,
          });
          gameElement.dispatchEvent(keyPressEvent);

          // Introduce a delay before simulating keyup
          setTimeout(() => {
            // Simulate keyup event (to prevent key from being stuck)
            const keyReleaseEvent = new KeyboardEvent("keyup", {
              key: keyValue,
              code: keyValue,
              keyCode: keyCode,
              which: keyCode,
              bubbles: true,
              cancelable: true,
            });
            gameElement.dispatchEvent(keyReleaseEvent);
          }, 1); // Delay of 100 milliseconds
        }
      }

      // Listen for custom event from the parent window to trigger different key presses
      window.addEventListener("message", (event) => {
        switch (event.data) {
          case "Right":
            focusAndPressKey(39, "ArrowRight"); // Press 'ArrowRight' for Right
            console.log("Right arrow pressed");
            break;
          case "Left":
            focusAndPressKey(37, "ArrowLeft"); // Press 'ArrowLeft' for Left
            console.log("Left arrow pressed");
            break;
          case "Up":
            focusAndPressKey(38, "ArrowUp"); // Press 'ArrowUp' for Jump
            break;
          case "Down":
            focusAndPressKey(40, "ArrowDown"); // Press 'ArrowDown' for Down
            break;
          default:
            // Do nothing for other cases
            break;
        }
      });
    </script>
  </body>
</html>
